<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="rokad.css">
</head>

<body>
    <div class="layout">
        <div class="rokad-layout">
            <div class="head">
                <div class="topheading">
                    <h1>Rokad</h1>
                </div>
                <div class="topheading2">
                    <h3>Karyalay</h3>
                    <p id="panchaya_name">hello hello hello hello</p>
                </div>
            </div>
            <table id="rokadTable">
                <tr id="ttrth">
                    <th rowspan="2">Date</th>
                    <th rowspan="2">S.NO</th>
                    <th rowspan="2">Anu ke Mamale me Khata Panna</th>
                    <th rowspan="2">Prapptiyo ke Byore</th>
                    <th colspan="3">Praptiya</th>
                    <th rowspan="2" class="rotate-text">Signature</th>
                </tr>
                <tr>
                    <th>Cash Amount</th>
                    <th>Bank Amount</th>
                    <th>Bajat Ka Lekha Shirsh</th>
                </tr>
                <tr>
                    <th>1</th>
                    <th>2</th>
                    <th>3</th>
                    <th>4</th>
                    <th>5</th>
                    <th>6</th>
                    <th>7</th>
                    <th>8</th>
                </tr>
            </table>
        </div>
        <div class="bahi-layout">
            <div class="head">
                <div class="bahi-topheading">
                    <h1>Bahi</h1>
                </div>
                <div class="topheading2">
                    <h3>Year</h3>
                    <p id="Year_name">2023</p>
                </div>
            </div>
            <table id="bahiTable">
                <tr id="ttrth">
                    <th rowspan="2">Date</th>
                    <th rowspan="2">S.NO</th>
                    <th rowspan="2">E.P.N No.</th>
                    <th rowspan="2">Anu ke Mamale me Khata Panna</th>
                    <th rowspan="2">Prapptiyo ke Byore</th>
                    <th colspan="3">Vyay Ka Vivran</th>
                    <th rowspan="2" class="rotate-text">Signature</th>
                </tr>
                <tr>
                    <th>Cash Amount</th>
                    <th>Bank Amount</th>
                    <th>Bajat Ka Lekha Shirsh</th>
                </tr>
                <tr>
                    <th>9</th>
                    <th>10</th>
                    <th>11</th>
                    <th>12</th>
                    <th>13</th>
                    <th>14</th>
                    <th>15</th>
                    <th>16</th>
                    <th>17</th>
                </tr>
            </table>
        </div>
    </div>

    <script>

        function calculateAndStoreTotal() {
            var formTypes = ['rokad', 'bahi'];

            formTypes.forEach(function (formType) {
                var formCount = localStorage.getItem(formType + "FormCount");
                var totalData = {};

                for (var i = 1; i <= formCount; i++) {
                    var formData = localStorage.getItem(formType + "Data" + i);

                    if (formData) {
                        formData = JSON.parse(formData);
                        var currentDate = formData['Date'];
                        var nagadAmount = parseFloat(formData['Nagad Rashi']) || 0;
                        var bankAmount = parseFloat(formData['Bank Rashi']) || 0;

                        if (!totalData[currentDate]) {
                            totalData[currentDate] = {
                                nagadTotal: 0,
                                bankTotal: 0
                            };
                        }

                        totalData[currentDate].nagadTotal += nagadAmount;
                        totalData[currentDate].bankTotal += bankAmount;
                    }
                }

                // Store the calculated totals in localStorage for each date
                Object.keys(totalData).forEach(function (date) {
                    var dateTotal = totalData[date];
                    localStorage.setItem(formType + 'TotalData_' + date, JSON.stringify(dateTotal));
                });
            });
        }



        function sortDataByDate(data) {
            return data.sort(function (a, b) {
                var dateA = new Date(a['Date'] || a['date']);
                var dateB = new Date(b['Date'] || b['date']);
                return dateA - dateB;
            });
        }

        function insertBlankRow(table, numRows, cellCount, date) {
            for (var i = 0; i < numRows; i++) {
                var blankRow = table.insertRow(-1);
                for (var j = 0; j < cellCount; j++) {
                    var cell = blankRow.insertCell(j);
                    cell.innerHTML = "";  // Leave cells empty for a blank row
                }
            }
            rgetamuntdisplayData(date);
            brgetamuntdisplayData(date);
        }



        function rdisplayData(formType) {
            var formCount = localStorage.getItem(formType + "FormCount");
            var formDataArray = [];

            for (var i = 1; i <= formCount; i++) {
                var formData = localStorage.getItem(formType + "Data" + i);

                if (formData) {
                    formData = JSON.parse(formData);
                    formDataArray.push(formData);
                }
            }

            formDataArray = sortDataByDate(formDataArray);

            var table = document.getElementById(formType + 'Table');
            var prevDate = null;

            for (var i = 0; i < formDataArray.length; i++) {
                var currentDate = formDataArray[i]['Date'];

                if (prevDate && currentDate !== prevDate) {
                    insertBlankRow(table, 7, 8, currentDate);  // Adjust cell count accordingly
                }

                var row = table.insertRow(-1);

                var cell = row.insertCell(0);
                cell.innerHTML = currentDate;

                if (formDataArray[i]['Particular'] != "" || formDataArray[i]['Particular'] !== "") {
                    var bakiseril = localStorage.getItem("rokadsno");
                    bakiseril++;
                    var cell = row.insertCell(1);
                    cell.innerHTML = bakiseril;
                    localStorage.setItem("rokadsno", bakiseril);
                } else {
                    var cell = row.insertCell(1);
                    cell.innerHTML = "";
                    // cell.innerHTML = formDataArray[i]['S.no'];
                }

                var cell = row.insertCell(2);
                cell.innerHTML = formDataArray[i]['AKMMKP'];

                var cell = row.insertCell(3);
                cell.innerHTML = formDataArray[i]['Particular'] || "";

                var cell = row.insertCell(4);
                cell.innerHTML = formDataArray[i]['Nagad Rashi'] || "";

                var cell = row.insertCell(5);
                cell.innerHTML = formDataArray[i]['Bank Rashi'] || "";

                var cell = row.insertCell(6);
                cell.innerHTML = formDataArray[i]['Bajt LS'] || "";

                var cell = row.insertCell(7);
                cell.innerHTML = formDataArray[i]['Signature'] || "";

                prevDate = currentDate;
            }
            
        }

        function bdisplayData(formType) {
            var formCount = localStorage.getItem(formType + "FormCount");
            var formDataArray = [];

            for (var i = 1; i <= formCount; i++) {
                var formData = localStorage.getItem(formType + "Data" + i);

                if (formData) {
                    formData = JSON.parse(formData);
                    formDataArray.push(formData);
                }
            }

            formDataArray = sortDataByDate(formDataArray);

            var table = document.getElementById(formType + 'Table');
            var prevDate = null;

            for (var i = 0; i < formDataArray.length; i++) {
                var currentDate = formDataArray[i]['Date'];

                if (prevDate && currentDate !== prevDate) {
                    insertBlankRow(table, 7, 9);  // Adjust cell count accordingly
                }

                var row = table.insertRow(-1);

                var cell = row.insertCell(0);
                cell.innerHTML = currentDate;

                if (formDataArray[i]['Particular'] != "" || formDataArray[i]['Particular'] !== "") {
                    var bakiseril = localStorage.getItem("bakisno");
                    bakiseril++;
                    var cell = row.insertCell(1);
                    cell.innerHTML = bakiseril;
                    localStorage.setItem("bakisno", bakiseril);
                } else {
                    var cell = row.insertCell(1);
                    // cell.innerHTML = formDataArray[i]['S.no'];
                    cell.innerHTML = "";
                }

                var cell = row.insertCell(2);
                cell.innerHTML = formDataArray[i]['E.P.N No.'];

                var cell = row.insertCell(3);
                cell.innerHTML = formDataArray[i]['AKMMKP'];

                var cell = row.insertCell(4);
                cell.innerHTML = formDataArray[i]['Particular'] || "";

                var cell = row.insertCell(5);
                cell.innerHTML = formDataArray[i]['Nagad Rashi'] || "";

                var cell = row.insertCell(6);
                cell.innerHTML = formDataArray[i]['Bank Rashi'] || "";

                var cell = row.insertCell(7);
                cell.innerHTML = formDataArray[i]['Bajt LS'] || "";

                var cell = row.insertCell(8);
                cell.innerHTML = formDataArray[i]['Signature'] || "";

                prevDate = currentDate;
            }
        }

        function baki() {
            localStorage.setItem("rokadsno", 0);
            localStorage.setItem("bakisno", 0);
            rdisplayData('rokad');
            bdisplayData('bahi');
        }

        baki();
        calculateAndStoreTotal();


        ////////////////////////////////////////////////////////////


        function rgetamuntdisplayData(date) {
            // var formCount = localStorage.getItem(formType + "FormCount");
            // var formDataArray = [];

            // for (var i = 1; i <= formCount; i++) {
            //     var formData = localStorage.getItem(formType + "Data" + i);

            //     if (formData) {
            //         formData = JSON.parse(formData);
            //         formDataArray.push(formData);
            //     }
            // }

            // formDataArray = sortDataByDate(formDataArray);

            var table = document.getElementById('rokadTable');
            // var prevDate = null;

            // for (var i = 0; i < formDataArray.length; i++) {
            //     var currentDate = formDataArray[i]['Date'];

            //     if (prevDate && currentDate !== prevDate) {
            //         insertBlankRow(table, 7, 8);  // Adjust cell count accordingly
            //     }

            var getdateformls = "rokadTotalData_" + date;

            var getdate = localStorage.getItem(getdateformls);

            var row = table.insertRow(-1);

            var cell = row.insertCell(0);
            cell.innerHTML = currentDate;

            var totaldatenagad = getdate.nagadTotal
            var totaldatebank = getdate.bankTotal

            var cell = row.insertCell(1);
            cell.innerHTML = getdate;
            // cell.innerHTML = formDataArray[i]['S.no'];

            var cell = row.insertCell(2);
            cell.innerHTML = "";

            var cell = row.insertCell(3);
            cell.innerHTML = "Aay";

            var cell = row.insertCell(4);
            cell.innerHTML = totaldatenagad;

            var cell = row.insertCell(5);
            cell.innerHTML = totaldatebank;

            var cell = row.insertCell(6);
            cell.innerHTML = "";

            var cell = row.insertCell(7);
            cell.innerHTML = "";


        }

        function brgetamuntdisplayData(date) {
            // var formCount = localStorage.getItem(formType + "FormCount");
            // var formDataArray = [];

            // for (var i = 1; i <= formCount; i++) {
            //     var formData = localStorage.getItem(formType + "Data" + i);

            //     if (formData) {
            //         formData = JSON.parse(formData);
            //         formDataArray.push(formData);
            //     }
            // }

            // formDataArray = sortDataByDate(formDataArray);

            var table = document.getElementById('bahiTable');
            var prevDate = null;

            // for (var i = 0; i < formDataArray.length; i++) {
            //     var currentDate = formDataArray[i]['Date'];

            //     if (prevDate && currentDate !== prevDate) {
            //         insertBlankRow(table, 7, 9);  // Adjust cell count accordingly
            //     }

            var getdateformls = "bahiTotalData_" + date;

            var getdate = localStorage.getItem(getdateformls);

            var totaldatenagad = getdate.nagadTotal
            var totaldatebank = getdate.bankTotal

            var row = table.insertRow(-1);

            var cell = row.insertCell(0);
            cell.innerHTML = date;


            var cell = row.insertCell(1);
            cell.innerHTML = "";


            var cell = row.insertCell(2);
            cell.innerHTML = "";

            var cell = row.insertCell(3);
            cell.innerHTML = "";

            var cell = row.insertCell(4);
            cell.innerHTML = "Vyay";

            var cell = row.insertCell(5);
            cell.innerHTML = totaldatenagad;

            var cell = row.insertCell(6);
            cell.innerHTML = totaldatebank;

            var cell = row.insertCell(7);
            cell.innerHTML = formDataArray[i]['Bajt LS'] || "";

            var cell = row.insertCell(8);
            cell.innerHTML = formDataArray[i]['Signature'] || "";

            // prevDate = currentDate;
        }
        

    </script>
</body>

</html>