<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="rb.css">
</head>

<body>
    <div class="layout">
        <div class="rokad-layout">
            <div class="head">
                <div class="topheading">
                    <h1>Rokad Bahi</h1>
                </div>
                <div class="topheading2">
                    <h3>Karyalay</h3>
                    <p id="panchaya_name">hello hello hello hello</p>
                </div>
            </div>
            <table id="combinedTable">
                <tr id="ttrth">
                    <th rowspan="2">Date</th>
                    <th rowspan="2">S.NO</th>
                    <th rowspan="2">Anu ke Mamale me Khata Panna</th>
                    <th rowspan="2">Prapptiyo ke Byore</th>
                    <th colspan="3">Praptiya</th>
                    <th rowspan="2" class="rotate-text">Signature</th>
                    <th rowspan="2">Date</th>
                    <th rowspan="2">S.NO</th>
                    <th rowspan="2">E.P.N No.</th>
                    <th rowspan="2">Anu ke Mamale me Khata Panna</th>
                    <th rowspan="2">Prapptiyo ke Byore</th>
                    <th colspan="3">Vyay Ka Vivran</th>
                    <th rowspan="2" class="rotate-text">Signature</th>
                </tr>
                <tr>
                    <th>Cash Amount</th>
                    <th>Bank Amount</th>
                    <th>Bajat Ka Lekha Shirsh</th>
                    <th>Cash Amount</th>
                    <th>Bank Amount</th>
                    <th>Bajat Ka Lekha Shirsh</th>
                </tr>
                <tr>
                    <th>1</th>
                    <th>2</th>
                    <th>3</th>
                    <th>4</th>
                    <th>5</th>
                    <th>6</th>
                    <th>7</th>
                    <th>8</th>
                    <th>9</th>
                    <th>10</th>
                    <th>11</th>
                    <th>12</th>
                    <th>13</th>
                    <th>14</th>
                    <th>15</th>
                    <th>16</th>
                    <th>17</th>
                </tr>
            </table>
        </div>
    </div>

    <script>

        var nagadpurve_Shesh = localStorage.setItem("nagadpurve_Shesh", 1000);
        var bankpurve_Shesh = localStorage.setItem("bankpurve_Shesh", 1000);
        localStorage.setItem("contvalueccc",0);


        function sortDataByDate(data) {
            return data.sort(function (a, b) {
                var dateA = new Date(a['Date'] || a['date']);
                var dateB = new Date(b['Date'] || b['date']);
                return dateA - dateB;
            });
        }

        function insertBlankRow(table, numRows, cellCount, date) {
            for (var i = 0; i < 3; i++) {
                var blankRow = table.insertRow(-1);
                for (var j = -1; j < cellCount; j++) {
                    var cell = blankRow.insertCell(j);
                    cell.innerHTML = "";  // Leave cells empty for a blank row
                }
            }


            avrokadbahidisplayData(date);

            for (var i = 0; i < 2; i++) {
                var blankRow = table.insertRow(-1);
                for (var j = -1; j < cellCount; j++) {
                    var cell = blankRow.insertCell(j);
                    cell.innerHTML = "";  // Leave cells empty for a blank row
                }
            }
        }

        function rokadbahidisplayData(formType) {
            var formCount = localStorage.getItem(formType + "FormCount");
            var formDataArray = [];

            for (var i = 1; i <= formCount; i++) {
                var formData = localStorage.getItem(formType + "Data" + i);

                if (formData) {
                    formData = JSON.parse(formData);
                    formDataArray.push(formData);
                }
            }

            formDataArray = sortDataByDate(formDataArray);

            var table = document.getElementById('combinedTable');
            var prevDate = null;

            for (var i = 0; i < formDataArray.length; i++) {
                var currentDate = formDataArray[i]['Date'];

                if (prevDate && currentDate !== prevDate) {
                    insertBlankRow(table, 7, 16, prevDate);  // Adjust cell count accordingly
                }

                var row = table.insertRow(-1);

                var cell = row.insertCell(0);
                cell.innerHTML = currentDate;


                if (formDataArray[i]['r_Particular'] != "" || formDataArray[i]['r_Particular'] !== "") {
                    var bakiseril = localStorage.getItem("rokadsno");
                    bakiseril++;
                    var cell = row.insertCell(1);
                    cell.innerHTML = bakiseril;
                    localStorage.setItem("rokadsno", bakiseril);
                } else {
                    var cell = row.insertCell(1);
                    cell.innerHTML = "";
                    // cell.innerHTML = formDataArray[i]['S.no'];
                }

                var cell = row.insertCell(2);
                cell.innerHTML = formDataArray[i]['r_AKMMKP'];

                var cell = row.insertCell(3);
                cell.innerHTML = formDataArray[i]['r_Particular'];

                var cell = row.insertCell(4);
                cell.innerHTML = formDataArray[i]['r_Nagad Rashi'];

                var cell = row.insertCell(5);
                cell.innerHTML = formDataArray[i]['r_Bank Rashi'];

                var cell = row.insertCell(6);
                cell.innerHTML = formDataArray[i]['r_Bajt LS'];

                var cell = row.insertCell(7);
                cell.innerHTML = formDataArray[i]['Signature'];

                var cell = row.insertCell(8);
                cell.innerHTML = currentDate;

                if (formDataArray[i]['b_Particular'] != "" || formDataArray[i]['b_Particular'] !== "") {
                    var bakiseril = localStorage.getItem("bakisno");
                    bakiseril++;
                    var cell = row.insertCell(9);
                    cell.innerHTML = bakiseril;
                    localStorage.setItem("bakisno", bakiseril);
                } else {
                    var cell = row.insertCell(9);
                    // cell.innerHTML = formDataArray[i]['S.no'];
                    cell.innerHTML = "";
                }

                var cell = row.insertCell(10);
                cell.innerHTML = formDataArray[i]['b_E.P.N No.'];

                var cell = row.insertCell(11);
                cell.innerHTML = formDataArray[i]['b_AKMMKP'];

                var cell = row.insertCell(12);
                cell.innerHTML = formDataArray[i]['b_Particular'] || "";

                var cell = row.insertCell(13);
                cell.innerHTML = formDataArray[i]['b_Nagad Rashi'] || "";

                var cell = row.insertCell(14);
                cell.innerHTML = formDataArray[i]['b_Bank Rashi'] || "";

                var cell = row.insertCell(15);
                cell.innerHTML = formDataArray[i]['b_Bajt LS'] || "";

                var cell = row.insertCell(16);
                cell.innerHTML = formDataArray[i]['Signature'] || "";

                prevDate = currentDate;
            }
        }




        function calculateAndStoreTotal() {
            var formTypes = ['rb'];

            formTypes.forEach(function (formType) {
                var formCount = localStorage.getItem(formType + "FormCount");
                var totalData = {};

                for (var i = 1; i <= formCount; i++) {
                    var formData = localStorage.getItem(formType + "Data" + i);

                    if (formData) {
                        formData = JSON.parse(formData);
                        var currentDate = formData['Date'];
                        var r_nagadAmount = parseFloat(formData['r_Nagad Rashi']) || 0;
                        var r_bankAmount = parseFloat(formData['r_Bank Rashi']) || 0;
                        var b_nagadAmount = parseFloat(formData['b_Nagad Rashi']) || 0;
                        var b_bankAmount = parseFloat(formData['b_Bank Rashi']) || 0;

                        if (!totalData[currentDate]) {
                            totalData[currentDate] = {
                                r_nagadTotal: 0,
                                r_bankTotal: 0,
                                b_nagadTotal: 0,
                                b_bankTotal: 0
                            };
                        }

                        totalData[currentDate].r_nagadTotal += r_nagadAmount;
                        totalData[currentDate].r_bankTotal += r_bankAmount;
                        totalData[currentDate].b_nagadTotal += b_nagadAmount;
                        totalData[currentDate].b_bankTotal += b_bankAmount;
                    }
                }

                // Store the calculated totals in localStorage for each date
                Object.keys(totalData).forEach(function (date) {
                    var dateTotal = totalData[date];
                    localStorage.setItem(formType + 'TotalData_' + date, JSON.stringify(dateTotal));
                });
            });
        }


        function avrokadbahidisplayData(date) {
            var nagadpurve_Shesh = localStorage.getItem("nagadpurve_Shesh") || 0;
            var bankpurve_Shesh = localStorage.getItem("bankpurve_Shesh") || 0;

           var contvalueccc =  localStorage.getItem("contvalueccc");
           var a = 1;
           console.log(a)
           a++;
           contvalueccc++;
           localStorage.setItem("contvalueccc",contvalueccc);
            // purve_rashi = JSON.parse(purve_rashi);
            // purve_Shesh

            var rbTotalData_date = "rbTotalData_" + date;
            var rbTotalData = localStorage.getItem(rbTotalData_date);

            // Parse the JSON string to get a JavaScript object
            rbTotalData = JSON.parse(rbTotalData);

            // Check if rbTotalData is not null or undefined before accessing its properties
            if (rbTotalData) {
                var r_nagadAmount = rbTotalData.r_nagadTotal || 0;
                var r_bankAmount = rbTotalData.r_bankTotal || 0;
                var b_nagadAmount = rbTotalData.b_nagadTotal || 0;
                var b_bankAmount = rbTotalData.b_bankTotal || 0;

                console.log(b_bankAmount);

                var table = document.getElementById('combinedTable');
                var row = table.insertRow(-1);
                var row2 = table.insertRow(-1);
                var row3 = table.insertRow(-1);

                var cell = row.insertCell(0);
                cell.innerHTML = date;

                var cell = row.insertCell(1);
                cell.innerHTML = "";

                var cell = row.insertCell(2);
                cell.innerHTML = "";

                var cell = row.insertCell(3);
                cell.innerHTML = "Aay";

                var cell = row.insertCell(4);
                cell.innerHTML = r_nagadAmount;

                var cell = row.insertCell(5);
                cell.innerHTML = r_bankAmount;

                var cell = row.insertCell(6);
                cell.innerHTML = "";

                var cell = row.insertCell(7);
                cell.innerHTML = "";

                var cell = row.insertCell(8);
                cell.innerHTML = date;

                var cell = row.insertCell(9);
                cell.innerHTML = "";

                var cell = row.insertCell(10);
                cell.innerHTML = "";

                var cell = row.insertCell(11);
                cell.innerHTML = "";

                var cell = row.insertCell(12);
                cell.innerHTML = "Vyay";

                var cell = row.insertCell(13);
                cell.innerHTML = b_nagadAmount;

                var cell = row.insertCell(14);
                cell.innerHTML = b_bankAmount;

                var cell = row.insertCell(15);
                cell.innerHTML = "";

                var cell = row.insertCell(16);
                cell.innerHTML = "";

                //row 2

                var cell = row2.insertCell(0);
                cell.innerHTML = date;

                var cell = row2.insertCell(1);
                cell.innerHTML = "";

                var cell = row2.insertCell(2);
                cell.innerHTML = "";

                var cell = row2.insertCell(3);
                cell.innerHTML = "Purv Shesh";

                var cell = row2.insertCell(4);
                cell.innerHTML = nagadpurve_Shesh;
                localStorage.setItem("nagadpurve_Shesh", nagadpurve_Shesh);

                var cell = row2.insertCell(5);
                cell.innerHTML = bankpurve_Shesh;
                localStorage.setItem("bankpurve_Shesh", bankpurve_Shesh);


                var cell = row2.insertCell(6);
                cell.innerHTML = "";

                var cell = row2.insertCell(7);
                cell.innerHTML = "";

                var cell = row2.insertCell(8);
                cell.innerHTML = date;

                var cell = row2.insertCell(9);
                cell.innerHTML = "";

                var cell = row2.insertCell(10);
                cell.innerHTML = "";

                var cell = row2.insertCell(11);
                cell.innerHTML = "";

                var cell = row2.insertCell(12);
                cell.innerHTML = "Shesh";

                var nagadpurve_Shesh = localStorage.getItem("nagadpurve_Shesh");
                var bankpurve_Shesh = localStorage.getItem("bankpurve_Shesh");

                var cell = row2.insertCell(13);
                cell.innerHTML = nagadpurve_Shesh;

                var cell = row2.insertCell(14);
                cell.innerHTML = bankpurve_Shesh;

                var cell = row2.insertCell(15);
                cell.innerHTML = "";

                var cell = row2.insertCell(16);
                cell.innerHTML = "";

                // row 3

                var cell = row3.insertCell(0);
                cell.innerHTML = date;

                var cell = row3.insertCell(1);
                cell.innerHTML = "";

                var cell = row3.insertCell(2);
                cell.innerHTML = "";

                var cell = row3.insertCell(3);
                cell.innerHTML = "Yog";

                var cell = row3.insertCell(4);
                var total = parseFloat(r_nagadAmount) + parseFloat(nagadpurve_Shesh);
                cell.innerHTML = total;

                var cell = row3.insertCell(5);
                var total = parseFloat(r_bankAmount) + parseFloat(bankpurve_Shesh);
                cell.innerHTML = r_bankAmount;

                var cell = row3.insertCell(6);
                cell.innerHTML = "";

                var cell = row3.insertCell(7);
                cell.innerHTML = "";

                var cell = row3.insertCell(8);
                cell.innerHTML = date;

                var cell = row3.insertCell(9);
                cell.innerHTML = "";

                var cell = row3.insertCell(10);
                cell.innerHTML = "";

                var cell = row3.insertCell(11);
                cell.innerHTML = "";

                var cell = row3.insertCell(12);
                cell.innerHTML = "Yog";

                var nagadpurve_Shesh = localStorage.getItem("nagadpurve_Shesh");
                var bankpurve_Shesh = localStorage.getItem("bankpurve_Shesh");

                var total2 =  parseFloat(nagadpurve_Shesh) - parseFloat(r_nagadAmount);
                var total22 = parseFloat(nagadpurve_Shesh) - parseFloat(r_nagadAmount);

                var cell = row3.insertCell(13);
                cell.innerHTML = total2;

                var cell = row3.insertCell(14);
                cell.innerHTML = total22;

                var cell = row3.insertCell(15);
                cell.innerHTML = "";

                var cell = row3.insertCell(16);
                cell.innerHTML = "";

            }
        }




        function baki() {
            localStorage.setItem("rokadsno", 0);
            localStorage.setItem("bakisno", 0);
            rokadbahidisplayData('rb');
            // rokadbahidisplayData('bahi');
        }

        baki();
        calculateAndStoreTotal();

    </script>
</body>

</html>